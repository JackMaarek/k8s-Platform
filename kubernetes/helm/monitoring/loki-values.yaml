# Loki Helm Chart Values
# Chart: grafana/loki in SingleBinary mode (replaces deprecated loki-stack)
# @todo: rework for prod — switch to SimpleScalable with object storage

deploymentMode: SingleBinary

loki:
  auth_enabled: false
  commonConfig:
    replication_factor: 1
  storage:
    type: filesystem
  schemaConfig:
    configs:
      - from: "2024-01-01"
        store: tsdb
        object_store: filesystem
        schema: v13
        index:
          prefix: index_
          period: 24h
  limits_config:
    retention_period: 168h
  securityContext:
    runAsNonRoot: true
    runAsUser: 10001
    runAsGroup: 10001
    fsGroup: 10001
    seccompProfile:
      type: RuntimeDefault
  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop: ["ALL"]
    readOnlyRootFilesystem: false

singleBinary:
  replicas: 1
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi
  persistence:
    enabled: true
    size: 20Gi

# memcached issues, was requesting 9830Mi otherwise - local
#@todo: test cache efficiency to allocate right amount depending on available memory.
chunksCache:
  enabled: true
  allocatedMemory: 512

resultsCache:
  enabled: true
  allocatedMemory: 256

# Zero out all other deployment mode replicas — required by chart validation
# See https://grafana.com/docs/loki/latest/setup/install/helm/install-monolithic/
write:
  replicas: 0
read:
  replicas: 0
backend:
  replicas: 0
ingester:
  replicas: 0
distributor:
  replicas: 0
querier:
  replicas: 0
queryFrontend:
  replicas: 0
queryScheduler:
  replicas: 0
indexGateway:
  replicas: 0
compactor:
  replicas: 0
bloomCompactor:
  replicas: 0
bloomGateway:
  replicas: 0

# Grafana disabled — using kube-prometheus-stack's Grafana instance
grafana:
  enabled: false

# Promtail disabled — installed as standalone chart
promtail:
  enabled: false

gateway:
  enabled: false

# @todo: enable in prod
test:
  enabled: false

